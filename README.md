# Circe

> A Kafka plugin wrapper that augments it's plugins to use validators for producers and consumers

Leverage your own validator against any publishable/consumable event. This is basically an extender
of it's plugin as it augments it's plugin's API. 

## Requirements

1.  Access to ParkHub's private NPM repos
2.  Node version greater than 8.x.x
3.  One of it's plugins, will not do anything by itself.

## Installation

Distributed via NPM in Parkhub's private repository.
`npm install @parkhub/circe`

## Usage

```javascript
import circe from '@parkhub/circe';
import circePlugin from 'circe-plugin';

const sourcer = circe({ plugin: circePlugin, connection: 'connectiontokafka:9042'});

const testEvent = 'testEvent';
const validators = {
  [testEvent]: {
    validateAndCreateMessage({ message }) {
      return Object.assign({}, message, { change: 'change' });
    }
  }
};

const producer = sourcer.createProducer({
  validators,
  pluginCfgs: {
    configOne: 'nope'
  }
});

producer.publishEvent({
  event: testEvent,
  message: {
    test: messageBroker
  },
  pluginCfgs: {
    configOne: 'publish'
  }
});


const consumer = await sourcer.createConsumer({
  validators,
  pluginCfgs: {
    pluginConfOne: 'hi'
  }
});

const handler = ({ message }) => {
  // Do something with message
};

consumer.subscribeToEvent({ 
  event: testEvent, 
  pluginCfgs: { 
    consumerConf: 'test'
  } 
});
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### producer

Circe overrides a consumers subscribeToEvent method and a producers publishEvent method from it's
plugin to provide custom validation mechanics. Each overriden method requires "validators" to
use by matching the Kafka topic it's publishing/consuming to the object's key and calling a
validateAndCreateMessage for it.

**Meta**

-   **author**: Daniel Olivares

### producer

Producer factory that overrides the plugins publishEvent method and injects the validator logic.

**Parameters**

-   `cfgs` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** configuration for producer (optional, default `{}`)
    -   `cfgs.plugin` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Plugin which provides actual logic for Kafka whose method will
        be overriden
    -   `cfgs.validators` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** A key-value map of events being published whose value is an
        object with a validateAndCreateMessage method
    -   `cfgs.pluginCfgs` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Configurations that are specific to the plugin

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object), [Error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error)>** A promise that fulfills with an instance of a producer from
plugin

### CirceInstance

Type: [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)

**Parameters**

-   `cfgs`  

**Properties**

-   `createProducer` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** Producer factory to create producers from eventCfgs
-   `createConsumer` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** Consumer factory to create consumers from eventCfgs

### circe

Circe factory function

**Parameters**

-   `cfgs`  
-   `Object`  cfgs configurations for factory
-   `Object`  cfgs.plugin Plugin definition that matches the Plugin interface
-   `Object`  cfgs.connection Configurations for creating and publishing an Event

Returns **any** CirceInstance circe methods

### consumer

Consumer factory that overrides the plugins subscribeToEvent method and injects the validator
logic.

**Parameters**

-   `cfgs` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** configuration for consumer (optional, default `{}`)
    -   `cfgs.plugin` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Plugin which provides actual logic for Kafka whose method will
        be overriden
    -   `cfgs.validators` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** A key-value map of events being consumed whose value is an
        object with a validateAndCreateMessage method
    -   `cfgs.pluginCfgs` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Configurations that are specific to the plugin

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object), [Error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error)>** A promise that fulfills with an instance of a producer from
plugin
